# library-database
روژه پایگاه داده
موضوع: پایگاه اطلاعات یک کتابخانه
تهیه شده توسط: انیس نبی پور آزاده
ش.دانشجویی 1400442144

مدل E-R :
https://imgur.com/a/YSzg6JU
این مدل از چهار(strong) entity set و سه relationship set  تشکیل شده:
جدول librarian نشان دهنده کتابداران کتابخانه است که برای هر کتابدار یک ID منحصر به فرد اختصاص داده شده که به عنوان کلید اولیه، می توان هر تاپل را با آن تشخیص داد. جدول librarian به صورت many-to-one از جدول area با خودش، در رابطه¬ی "ناحیه کاری" قرار دارد؛ به این صورت که هر ناحیه باید برای خود کتابداری داشته باشد تا اعضای کتابخانه را در پیدا کردن و راهنمایی در مورد کتاب¬های موجود آن ناحیه کمک کند. به همین علت این رابطه از سمت area باید به صورت total باشد زیرا هر ناحیه¬ای باید حتما یک کتابدار داشته باشد، اما یک کتابدار می¬تواند مسئول چندین بخش مختلف باشد.
جدول book نیز، همانطور که واضح است، نشان دهنده اطلاعات تمامی کتاب¬های موجود در کتابخانه است که با یک ID منحصر به فرد به همراه عنوان، نام نویسنده، ناشر، زبان، سال انتشار و یک شماره سریال ISBN که نشان دهنده نسخه کتاب است، مشخص می¬شود. جدول کتاب¬ها با جدول مربوط به  اعضای کتابخانه که با عنوان member نمایش داده شده، در رابطه¬ی many-to-many "امانت گرفتن" شرکت می¬کند. بدین شکل هر عضو می¬تواند چندین کتاب امانت بگیرد و هر کتاب می تواند توسط چندین نفر به امانت گرفته شود (هر بار در زمان¬های مختلف؛ زیرا ابتدا باید کتاب امانت گرفته شده پس داده شود تا شخص دیگری آن را دوباره به امانت بگیرد). بنابراین این رابطه، باید توسط چند attribute دیگر نیز مشخص شود تا تاریخ امانت گرفتن و برگرداندن، وضعیتِ امانت و همچنین جریمه نقدی (fine) به علت تحویل دیرهنگام (بسته به مدت تاخیر افزایش تعیین می¬شود) نمایش داده شود.
در آخر نیز می¬بینیم که جدول کتاب¬ با جدول ناحیه در رابطه است تا نشان دهد هر کتابی باید در یک ناحیه ذخیره و نگهداری شده باشد. از آنجایی که هر ناحیه چندین کتاب و هر کتاب یک ناحیه دارد این رابطه به صورت many-to-one از جدول کتاب به ناحیه متصل شده.

پیاده سازی پایگاه داده در یک سرور DBMS:
برای انجام این کار از نسخه 8.0.33 MySQL استفاده می¬کنیم.
شمای جداول مربوطه به این صورت بر روی پایگاه داده¬ی “library” پیاده خواهد شد:
book(b-ID, shelf, title, author, publisher, publication-year, language,ISBN)
member(m-ID, first-name, last-name, date-of-birth, phone-number, date-of-membership, tot-fine)
librarian(l-ID, first-name, last-name, date-of-birth, phone-number, salary)
area(name, librarian, start-shelf, end-shelf)
borrows(m-ID, b-ID, borrow-date, return-date, status, fine)
توجه: در جدولِ امانت، از آنجایی که یک عضو، یک کتاب بخصوص را چندین بار می تواند امانت بگیرد، ضروری است که تاریخِ امانت را نیز به همراه آیدی کتاب و آیدی عضو، به عنوان کلید اولیه در نظر بگیریم.

کدهای SQL ساخت جداول به همراه جدول  ساخته شده:
--------------
در ساخت این جدول برای اینکه آیدی هر کتاب به طور خاصی انتخاب شود، به وسیله دستور 
GENERATED ALWAYS AS (Expression) STORED
و به نیز با دستور concat()، مشخص کردیم که هنگام ساختِ هر تاپل، باید 5 حرف ابتدای نام نویسنده، 4 رقم سال چاپ و 3 رقم شماره قفسه¬ای که کتاب در آن ذخیره شده با هم ادغام و به وسیله یک "-" از هم جدا شده و در فیلد b-ID آن کتاب ذخیره شود. تمام فیلدها به جزISBN  و شماره قفسه که عددی هستند، در فرمت کارکتری ذخیره می¬شود.
---------------
برای جدول member نیز به طور مشابه عمل می¬شود. نکته قابل ذکر در اینجا این است که تاریخ¬ها از نوع داده date می¬باشند؛ به این صورت که سال، ماه، و روز در کنار هم با یک جداکننده "-" ذخیره می شود و بعدا با این نوعِ داده می¬توان کارهای مختلفی از جمله محاسبه مدت زمان بین دو تاریخ و... انجام داد.
--------------
در ساختِ جدول borrows، می¬بایستی به این علت که دو attribute مهم آن که به آیدی یک کتاب و آیدی عضو اشاره دارد، در قسمت قواعد به عنوان foreign key، تعریف شود تا هنگام اضافه کردن دیتاها، مطمئن شویم آیدی¬های مربوطه حتما وجود دارند و قبلا تعریف شده¬اند.
همچنین در تعریف فیلد جریمه یا fine، از مقدار دیفالتِ صفر، استفاده کرده¬ایم تا به طور پیشفرض هر امانت را بدون جریمه در حالت اولیه در نظر بگیرد.
-----------------------
در تعریف جدول librarian، بعد از تعریف attributeها، در قسمت قواعد به وسیله دستور check، تعیین کردیم که هر مقدار حقوقی که برای هر کتابدار ثبت می¬شود نباید کمتر از 50000 (دلار) باشد. در غیر این صورت آن مقدار ثبت نخواهد شد.
---------------------
در کد ساخت area، از آنجایی که باید محدوده کار هر کتابدار نیز مشخص شود، باید یک قاعده ارجاعی به جدول کتابداران ایجاد شود که فیلد librarian را به l-ID در جدول librarian مرتبط کند تا مشخص شود هر آیدی حتما نشان دهنده یک کتابدار واقعی در کتابخانه است.
توجه: ما برای رابطه stored in که بین جدول کتاب¬ها و ناحیه مربوط به آن کتاب بو،د هیچ فیلد جدیدی در هیچ کدام از جداول ایجاد نکردیم تا این رابطه را مشخص کند. این به این دلیل است که به وسیله شماره قفسه هر کتاب و رنج قفسات مربوط به هر ناحیه، می¬توان مشخص کرد که هر کتاب متعلق به کتاب بخش است و به اینگونه از تکرار اطلاعات اضافی و جاگیری ظرفیت حافظه جلوگیری می¬کنیم.

دادن دیتا به جداول:
برای این منظور، به جای اینکه هر سطر را به طور جداگانه به وسیله دستور insert به جدول اضافه کنیم، از قبل اطلاعات را در یک فایل .csv  ذخیره کردیم و بعد آن فایل را به داخل هر جدولimport کردیم بدون آنکه نیازی به درج جداگانه داشته باشد.
در ابتدا دستور
SELECT * FROM <table-name>;
 اجرا می¬کنیم تا اطلاعات ذخیره شده در هر جدول را مشاهده کنیم:
Inserted data in `book` relation:

Inserted data in `member` relation:

Inserted data in `librarian` relation:

Inserted data in `area` relation:

Inserted data in `borrows` relation:


انجام چند query ساده:
پرسمان 1) نام و نام خانوادگی اعضایی که هیچ کتابی را به امانت نگرفته¬اند:

پرسمان 2)   نام کتاب¬هایی که هنوز برگردانده نشده به همراه نویسنده آن:

پرسمان 3) کتاب¬هایی که در بخش novel هستند:

پرسمان 4)کتابدارهایی که در بیشتر از دو بخش کار می¬کنند:

پرسمان5)کتاب هایی که بیشتر از دوبار امانت گرفته شده اند:
